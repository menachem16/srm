import React from 'react';

function RatingModal({ isOpen, onClose, content, user, onSuccess }) {   const [rating, setRating] = React.useState(0);   const [review, setReview] = React.useState('');   const [loading, setLoading] = React.useState(false);    React.useEffect(() => {     if (isOpen && content && user) {       loadUserRating();     }   }, [isOpen, content, user]);    const loadUserRating = async () => {     try {       const userRatings = await trickleListObjects(`rating:${user.objectId}`, 100, true);       const existingRating = userRatings.items.find(r => r.objectData.contentId === content.objectId);       if (existingRating) {         setRating(existingRating.objectData.rating);         setReview(existingRating.objectData.review || '');       }     } catch (error) {       console.error('Error loading user rating:', error);     }   };    const handleSubmit = async (e) => {     e.preventDefault();     setLoading(true);      try {       await trickleCreateObject(`rating:${user.objectId}`, {         userId: user.objectId,         contentId: content.objectId,         rating: rating,         review: review       });       onSuccess();       onClose();     } catch (error) {       alert('שגיאה בשמירת הדירוג');     } finally {       setLoading(false);     }   };    try {     if (!isOpen) return null;      return (       <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" data-name="rating-modal" data-file="components/RatingModal.js">         <div className="bg-gray-900 rounded-lg p-8 max-w-md w-full mx-4">           <div className="flex justify-between items-center mb-6">             <h2 className="text-2xl font-bold">דרג את התוכן</h2>             <button onClick={onClose}>               <div className="icon-x text-xl"></div>             </button>           </div>                      <form onSubmit={handleSubmit}>             <div className="mb-4">               <label className="block text-sm font-medium mb-2">דירוג</label>               <div className="flex space-x-1">                 {[1, 2, 3, 4, 5].map((star) => (                   <button                     key={star}                     type="button"                     className={`text-2xl ${rating >= star ? 'text-yellow-500' : 'text-gray-600'}`}                     onClick={() => setRating(star)}                   >                     <div className="icon-star"></div>                   </button>                 ))}               </div>             </div>                          <div className="mb-6">               <label className="block text-sm font-medium mb-2">ביקורת (אופציונלי)</label>               <textarea                 rows="4"                 className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded"                 value={review}                 onChange={(e) => setReview(e.target.value)}                 placeholder="שתף את דעתך על התוכן..."               />             </div>                          <button               type="submit"               disabled={loading || rating === 0}               className="w-full btn-primary disabled:opacity-50"             >               {loading ? 'שומר...' : 'שמור דירוג'}             </button>           </form>         </div>       </div>     );   } catch (error) {     console.error('RatingModal component error:', error);     return null;   } }

export default RatingModal;
